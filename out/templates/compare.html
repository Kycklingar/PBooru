{{template "base"}}

<style>
	#image-wraper
	{
		white-space:nowrap;
	}

	#image-wraper .default img:target
	{
		position:absolute;
		height:100%;
		left:50%;
		transform: translateX(-50%);
	}

	#image-wraper .zoom5x img
	{
		display:none;
	}

	#image-wraper .zoom5x img:target
	{
		position:absolute;
		top:0px;
		left:0px;
		display:inherit;
		transform: scale(5);
		transform-origin: top left;
		image-rendering: crisp-edges;
		filter: contrast(2);
	}

	#interface
	{
		position: fixed;
		bottom: 1em; 
		border: solid black;
		background-color: rgba(50, 50, 50, 0.75);
		overflow:auto;
		max-width:99%;
		text-shadow: 2px 2px 1px black;
	}

	#interface form
	{
		margin:0px;
	}

	#interface p
	{
		margin:2px;
	}
	
	#interface span
	{
		display: table-cell;
	}

	.thumb-button
	{
		position: absolute;
		background-color: rgba(50, 50, 50, 0.25);
		margin:10px;
		text-align:center;
		text-shadow: 2px 2px 1px black;
	}

	a, a :visited
	{
		color:inherit;
	}

	#full-interface
	{
		position:fixed;
		left:0px;
		right:0px;
		top:0px;
		bottom:0px;
		display:flex;

		background-color:#222B;
	}

	#left-interface
	{
		background-color:green;
		margin:1em;
	}

	#right-interface
	{
		width:100%;
		margin:1em;
		background-color:blue;
	}
</style>

<div>
	<h3>EZ compareâ„¢</h3>

	<div id="image-wraper">
		{{range .Posts}}
		<span postid="{{.ID}}">
		<span class="default">
			<a href="#"><img style="border:solid #{{$.ColorID .ID}};" id="img-{{.ID}}" src="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.Hash}}"></a>
		</span>
		<span class="zoom5x">
			<a href="#"><img style="border:solid #{{$.ColorID .ID}};" id="zoom-{{.ID}}" src="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.Hash}}"></a>
		</span>
		</span>
		{{end}}
	</div>
</div>

<details open  id="interface">
<summary style="cursor:pointer;">Interface</summary>
	<form>
		<input type="number" name="post-id" placeholder="Post ID">
		{{range .Posts}}
		<input type="hidden" name="post-id" value="{{.ID}}">
		{{end}}
		<input type="submit" value="Add post to compare">
	</form>
	<form>
		{{range .Posts}}
		<span postid="{{.ID}}" class="interface-post">
			<input type="hidden" name="post-id" value="{{.ID}}">
			<div style="position:relative;">
				<img style="border: solid #{{$.ColorID .ID}};" max-width="100px" max-height="100px" src="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.ClosestThumbnail 100}}">
				<a onclick="fit({{.ID}})" class="thumb-button" href="#img-{{.ID}}" style="top:0px; left:0px; right:0px; bottom:50%;">Fit</a>
				<a onclick="zoom({{.ID}})" class="thumb-button" href="#zoom-{{.ID}}" style="top:50%; left:0px; right:0px; bottom:0px">Zoom</a>
			</div>
			<div>
				<p>ID: <a href="/post/{{.ID}}/{{.Hash}}/">{{.ID}}</a></p>
				<p>Mime: {{.Mime.Type}} / {{.Mime.Name}}
				<p>Size: {{.SizePretty}}</p>
				{{with .Dimension}}
				<p>Dimensions: {{.Width}}x{{.Height}}</p>
				{{else}}
				<p>No dimensional data</p>
				{{end}}
			</div>
			<button type="submit" name="superior-id" value="{{.ID}}">Report as superior</button>
		</span>
		{{end}}
	</form>
</details>

<script>

	let posts = [
		{{range .Posts}}
		{
			"id":{{.ID}},
			"hash":{{.Hash}},
			"width":{{.Dimension.Width}},
			"height":{{.Dimension.Height}},
		},
		{{end}}
	]


	function fit(id)
	{
		let fi = fullInterface()

		let r = fi.children[1]
		let img = document.createElement("img")

		let hash = ""
		for (let i = 0; i < posts.length; i++)
		{
			if (posts[i].id == id)
			{
				hash = posts[i].hash
				break
			}
		}
		img.src = "http://localhost:8080/ipfs/" + hash

		r.appendChild(img)
		document.body.appendChild(fi)
	}

	function zoom(id)
	{
		
	}

	function fullInterface()
	{
		let fi = document.createElement("div")
		fi.id = "full-interface"

		fi.appendChild(leftInterface(posts))
		fi.appendChild(rightInterface(posts[0]))

		return fi
	}

	function leftInterface()
	{
		let li = document.createElement("div")
		li.id = "left-interface"

		for(let i = 0; i < posts.length; i++)
		{
			let d = document.createElement("div")
			let p = document.createElement("p")
			p.innerText = posts[i].id

			let pwidth = document.createElement("p")
			let pheight = document.createElement("p")

			pwidth.innerText = posts[i].width
			pheight.innerText = posts[i].height

			d.appendChild(p)
			d.appendChild(pwidth)
			d.appendChild(pheight)
			li.appendChild(d)
		}
		
		return li
	}

	function rightInterface(post)
	{
		let ri = document.createElement("div")
		ri.id = "right-interface"

		let img = document.createElement("img")
		img.src = "http://localhost:8080/ipfs/" + post.hash

		ri.appendChild(img)

		return ri
	}

	function addRemoveButton()
	{
		let ifp = document.getElementsByClassName("interface-post")
		console.log(ifp)
		for(let i = 0; i < ifp.length; i++)
		{
			let b = document.createElement("p")
			let p = ifp[i]
			b.onclick = function() {
				console.log(p)
				removePost(p)
			}
			b.innerText = "X"
			ifp[i].insertBefore(b, ifp[i].firstChild)
		}
	}

	function removePost(p)
	{
		let ps = document.getElementById("image-wraper")
		for(let i = 0; i < ps.children.length; i++)
		{
			if(ps.children[i].postid == p.postid)
			{
				ps.removeChild(ps.children[i])
				break
			}
		}

		p.parentElement.removeChild(p)
	}

	addRemoveButton()
</script>

{{template "baseEnd"}}
