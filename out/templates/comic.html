{{template "base" .Base}}

{{if .User.Flag.Comics}}
<details>
<summary>Create a new chapter</summary>
	<form method="POST" action="/comic/chapter/add/">
	    <input type="hidden" name="comic-id" value="{{.Comic.ID}}">
	    <input placeholder="Title" type="text" name="title">
	    <br>
	    <input placeholder="Order" type="text" name="order">
	    <br>
	    <input type="submit">
	</form>
</details>
{{end}}

<div id="comic-container">
	<h1>{{.Comic.Title}}</h1>
	{{range .Comic.Chapters}}
	<div class="comics-container">
		<h3><a href="/comic/{{.Comic.ID}}/{{.Order}}/">Chapter {{.Order}}</a>{{if .Title}} - {{.Title}}{{end}}</h3>
	    	<h4>Pages: {{.PageCount}}</h4>
	    	<div class="cpage-container">
		{{template "chapterPosts" wrap2 "UserInfo" "Posts" $.UserInfo (.PostsLimit 5)}}
		</div>
	</div>
	{{end}}
</div>

{{define "chapterPosts"}}
	{{$offset := 0}}
	{{$zindex := 10}}
	{{range .Posts}}
		<div style="position:absolute; left:{{$offset}}em; z-index:{{$zindex}};" class="comic-thumb" >
			{{$offset = add $offset 4}}
			{{$zindex = add $zindex -1}}
        	    	<a href="/post/{{.Post.ID}}/{{.Post.Hash}}">
        	            	<img style="border:1px solid black;" src="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.Post.ClosestThumbnail 256}}" alt="{{.Post.Hash}}">
        	    	</a>
        	</div>
	{{end}}
{{end}}

{{template "baseEnd"}}
