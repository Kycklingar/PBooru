{{ template "base" .Base}}

<div id="content">
    <div id="sidebar">
        {{ template "inner sidebar" .Sidebar}}
	<br>
	{{if .User.ID}}
		<form action="/post/vote/" method="POST">
			<input type="hidden" name="post-id" value="{{.Post.ID}}">
			<span>Score:</span>
			<input style="width:auto" type="submit" value="{{.Post.Score}}{{if .Voted}}--{{else}}++{{end}}">
		</form>
		<details>
		<summary onclick="swapInput()">Edit Post</summary>
        		<div id="editPostForm">
        			{{if .User.Flag.Tagging}}
        		    		<form method="POST">
        		    		    <p>Add tags</p>
        		    		    <textarea class="stinput" id="addtagsinput" name="addtags"></textarea>
        		    		    <p>Remove tags</p>
        		    		    <textarea class="stinput" id="remtagsinput" name="remtags"></textarea>
        		    		    <input type="submit" value="Submit edit">
        		    		</form>
        		    		<script type="text/javascript" src="/static/suggestions.js"></script>
			    	{{end}}
        			{{if .User.Flag.Delete}}
        		    		<form method="POST" action="/deletepost">
        		    		    <h3>Delete Post</h3>
        		    		    <input type="hidden" name="postid" value="{{.Post.ID}}">
        		    		    <input type="submit" value="Delete/Undelete">
        		    		</form>
        		    		<form method="POST" action="/dups/add/">
        		    		    <p>New Duplicate</p>
        		    		    <input type="hidden" name="postid" value="{{.Post.ID}}">
        		    		    <p>Dup post id</p>
        		    		    <input type="text" name="duppostid">
        		    		    <p>Level {{if ge .Dups.Level 1}}({{.Dups.Level}}){{end}}</p>
        		    		    <input type="text" name="level">
        		    		    <input type="submit">
        		    		</form>
        		    	{{end}}
        		</div>
		</details>
		<script>
		var lastInput = document.getElementById("remtagsinput")

		function swapInput()
		{
			console.log(input, lastInput)
			let tmp = lastInput
			lastInput = input
			input = tmp
		}
		</script>
		<details>
		<summary>Report post</summary>
			{{template "reportForm" .Post.ID}}
		</details>
		{{with .User.Pools}}
		<details>
			<summary>Add to pool</summary>
			<form method="POST" action="/user/pools/append/">
				<input type="hidden" name="post-id" value="{{$.Post.ID}}">
				<select style="min-width:100%;" name="pool-id">
					{{range .}}
					<option value="{{.ID}}">{{.Title}}</option>
					{{end}}
				</select>
				<input type="submit" value="Add">
			</form>
		</details>
		{{end}}
	{{else}}
		<div>Score: {{.Post.Score}}</div>
	{{end}}
	
    </div>
    <div id="post">
	{{if eq .Post.Mime.Type "image"}}
        <div id="image">
            <script>
                function resize(caller)
                {
                    if (caller.style.maxWidth == "unset"){
                        caller.style.maxWidth = "100%";
                    }else{
                        caller.style.maxWidth = "unset";
                    }
                    
                }
            </script>
            <img id="fullsize" onclick="resize(this)" src="{{.UserInfo.IpfsDaemon}}/ipfs/{{.Post.Hash}}">
	    <h4>
	    	<a href="#fullsize">Fullsize</a>
	    	<a href="#">Shrink to fit</a>
	    </h4>
        </div>
        {{else if eq .Post.Mime.Type "video"}}
        <div>
            <video loop controls>
                <source src="{{.UserInfo.IpfsDaemon}}/ipfs/{{.Post.Hash}}">
            </video>
        </div>
        {{else}}
	<div>
		<p>No Preview</p>
	</div>
        {{end}}
        <div style="padding-left: 4px;">
	    <h3>
            	<a href="{{.UserInfo.IpfsDaemon}}/ipfs/{{.Post.Hash}}" download>Download</a>
	    </h3>
	    {{with .Post.Description}}
		<div class="panel">
	    		<h3>Description</h3>
	    		<p>{{.}}</p>
		</div>
	    {{end}}
            <h4>ID:{{ .Post.ID }}</h4>
            <h4>{{ .Post.Hash }}</h4>
		{{with .Post.Thumbnails}}
			<span>Thumbnails:</span>
			<ul>
	    		{{range .}}
	    			<li>{{.Size}}px <a href="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.Hash}}">{{.Hash}}</a></li>
			{{end}}
			</ul>
		{{end}}
            <p>{{ .Post.Mime.Str }}</p>
	    <p>{{ .Post.SizePretty }}</p>
            {{ if .Post.Deleted }} <p style="color:#A00; text-shadow:1px 1px #400;">This post has been removed from search results.</p>{{ end }}
            <p><a href="/similar/?id={{.Post.ID}}">Find Similar</a></p>

            <div>
                {{if .User.ID}}
                <form method="POST">
                    <input type="hidden" name="comment" value="true">
                    <textarea cols="20" rows="1" name="text"></textarea>
                    <br>
                    <input type="submit" value="Post Comment">
                </form>
                {{end}}
                <ul id="commentlist">
                    {{ range .Comments }}
                    <li>
                        <div class="">
                            <b>
                            <span class="comment-username">{{if .User.ID}}{{.User.Name}}{{else}}Anonymous{{end}}</span>
                            <span> | </span>
                            <span class="comment-time">{{.Time}}</span>
                            </b>
                            <p>{{noescape .Text}}<p>
                        </div>
                    </li>
                    {{ end}}
                </ul>
            </div>
        </div>
    </div>
</div>




{{if .Dups.Posts}}
<div class="comics-container">
    <h3>Duplicates</h3>
    <div class="cpage-container">
        {{range .Dups.Posts}}
            <a href="/post/{{.ID}}/{{.Hash}}">
                <div class="comic-thumb">
                    <img class="{{if .Deleted}}deleted{{end}}{{if eq .ID $.Post.ID}} current{{end}}" src="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.ClosestThumbnail 256}}" alt="{{.Hash}}">
                </div>
            </a>
        {{end}}
    </div>
</div>
{{end}}

{{if .Comics}}
<div>
    {{range .Comics}}
    <div class="comics-container">
            <a href="/comic/{{.ID}}">
                <p>{{.Title}}</p>
            </a>
            Pages:{{.PageCount}}        
            <div class="cpage-container">
                {{range .ChaptersLimit 1}}
                    {{range .PostsLimit 5}}
                        <a href="/post/{{.Post.ID}}/{{.Post.Hash}}">
                            <div class="comic-thumb" {{if eq .Post.ID $.Post.ID}}style="border-style:solid;border-color:yellow;"{{end}}>
                                <img src="{{$.UserInfo.IpfsDaemon}}/ipfs/{{.Post.ClosestThumbnail 256}}" alt="{{.Post.Hash}}">
                            </div>
                        </a>
                    {{end}}
                {{end}}
            </div>
    </div>
    {{end}}
</div>
{{end}}

{{ template "userSettings" .UserInfo}}

<p>Page generated in {{.Time}}s</p>
{{ template "baseEnd" }}
